<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trades Tracker 2025</title>
    <style>
        body {
            font-family: Calibri, sans-serif;
            font-size: 20px;
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            color: #e0e0e0;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            max-width: 1200px;
            margin: 0px auto;
        }
        .month {
            grid-column: span 7;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            color: #ffffff;
        }
        .day {
            background-color: #0000;
            border: 1px solid #444444;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100px;
        }
        .day-header {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #ffffff;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 5px;
        }
        .input-group label {
            font-size: 12px;
            color: #cfcfcf;
        }
        .data-field {
            padding: 5px;
            font-size: 14px;
            border: none;
            background-color: transparent;
            outline: none;
            cursor: pointer;
            color: #e0e0e0;
        }
        .data-field.editable {
            border: 1px solid #888;
            background-color: #3c3c3c;
            cursor: text;
        }
        .data-field.profit {
            background-color: #9cffb6;
        }
        .data-field.loss {
            color: white;
            background-color: #dc2528;
        }
        .save-all-btn, .export-btn, .import-btn {
            background-color: #474E93;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            z-index: 1000;
        }
        .save-all-btn:hover, .export-btn:hover, .import-btn:hover {
            background-color: #0056b3;
        }
        .save-all-btn {
            position: fixed;
            top: 20px;
            right: 20px;
        }
        .export-btn {
            position: fixed;
            top: 20px;
            right: 85px;
        }
        .import-btn {
            position: fixed;
            top: 20px;
            right: 160px;
        }
    </style>
</head>

<body>
    <h2 style="text-align: center; margin: 20px 0;">Trades Tracker 2025</h2>
    <!--     <div id="totalBalance" style="text-align: center; font-size: 1em; margin: 10px 0; font-weight: bold; color: #000;">
        Total Balance: 0 CAD
    </div> -->
    <button class="save-all-btn">Save</button>
    <button class="export-btn" id="exportButton" onclick="saveToSpreadsheet()">Export</button>
    <button class="import-btn" id="importButton" onclick="document.getElementById('csvFileInput').click();">Import</button>
    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" />
    <div id="calendar" class="calendar"></div>
    <script>
    const months = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];

    let savedData = {};

    // Save data to a CSV file
    const saveToSpreadsheet = () => {
        const rows = [
            ["Date", "Underlying", "Profit (CAD)", "Number of Trades"]
        ];
        for (const [date, data] of Object.entries(savedData)) {
            rows.push([date, data.stockName || "", data.profit || "", data.trades || ""]);
        }

        const csvContent = rows.map(e => e.join(",")).join("\n");
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

        const fileName = "trades_tracker_2025.csv";
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", fileName);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    // Load data from a CSV file
    const loadFromCSV = (file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const content = e.target.result;
            const rows = content.split("\n").map(row => row.split(","));
            rows.shift(); // Remove header row
            savedData = {};
            rows.forEach(row => {
                const [date, stockName, profit, trades] = row;
                if (date) {
                    savedData[date.trim()] = {
                        stockName: stockName ?.trim() || "",
                        profit: profit ?.trim() || "",
                        trades: trades ?.trim() || ""
                    };
                }
            });
            generateCalendar();
        };
        reader.readAsText(file);
    };

    document.getElementById('csvFileInput').addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            loadFromCSV(file);
        }
    });

    const stockMarketHolidays = [
        "1/1/2025", // New Year's Day
        "1/20/2025", // Martin Luther King Jr. Day
        "2/17/2025", // Presidents' Day
        "4/18/2025", // Good Friday
        "5/26/2025", // Memorial Day
        "7/4/2025", // Independence Day
        "9/1/2025", // Labor Day
        "11/27/2025", // Thanksgiving Day
        "12/25/2025" // Christmas Day
    ];


    // Function to get the short day name (e.g., Mon, Tue, etc.)
    const getShortDayName = (date) => {
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        return days[new Date(date).getDay()]; // Returns short day name
    };

    // Initialize calendar with data from memory
    const generateCalendar = () => {
        const calendar = document.getElementById("calendar");
        calendar.innerHTML = ""; // Clear existing calendar

        const stockOptions = ['', '-', 'SPY', 'QQQ', 'NVDA', 'AAPL', 'AMD', 'META', 'TSLA']; // Stock options

        const today = new Date();

        months.forEach((month, monthIndex) => {
            const daysInMonth = new Date(2025, monthIndex + 1, 0).getDate();
            let monthlyProfit = 0; // Initialize monthly profit
            let zeroTradesCount = 0;
            let profitDaysCount = 0;
            let lossDaysCount = 0;

            // Calculate statistics for the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${monthIndex + 1}/${day}/2025`;
                const currentDate = new Date(2025, monthIndex, day);

                // Skip future dates and holidays
                if (currentDate > today || stockMarketHolidays.includes(dateKey)) continue;

                const profit = parseFloat(savedData[dateKey] ?.profit || 0);
                const trades = parseInt(savedData[dateKey] ?.trades || 0);

                // Add profit to the monthly total
                monthlyProfit += profit;

                // Count days based on conditions
                if (trades > 0) zeroTradesCount++;
                if (profit > 0) profitDaysCount++;
                if (profit < 0) lossDaysCount++;
            }


            // Create month header with statistics
            const monthHeader = document.createElement("div");
            monthHeader.className = "month";
            monthHeader.textContent = `${month} (Total Profit: ${monthlyProfit.toFixed(2)} CAD, No Trades: ${zeroTradesCount}, Profit Days: ${profitDaysCount}, Loss Days: ${lossDaysCount})`;
            calendar.appendChild(monthHeader);


            // Function to check if a given date is a weekend (Saturday or Sunday)
            const isWeekend = (date) => {
                const day = new Date(date).getDay();
                return day === 0 || day === 6; // Sunday (0) or Saturday (6)
            };

            // Inside the generateCalendar function, update the day display to check for weekends and holidays
            const createDayElement = (dateKey, isHoliday) => {
                const dayElement = document.createElement("div");
                dayElement.className = "day";

                //  Mark holidays and weekends visually
                if (isHoliday) {
                    // Log for debugging purposes
                    console.log("Holiday detected: " + dateKey);
                    dayElement.style.backgroundColor = "#2b2b2b"; // white for holidays or adjust as needed
                }

                // Format the date to show day name and date only (e.g., Mon 1)
                const [month, day] = dateKey.split('/');
                const shortDayName = getShortDayName(dateKey); // Get the short day name (e.g., Mon, Tue)
                const dayHeaderContent = `${shortDayName} ${parseInt(day)}`; // Display "Mon 1"

                const dayHeader = document.createElement("div");
                dayHeader.className = "day-header";
                dayHeader.textContent = dayHeaderContent + (isHoliday ? " (Holiday)" : "");
                dayElement.appendChild(dayHeader);

                return dayElement;
            };

            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${monthIndex + 1}/${day}/2025`;

                const isHoliday = stockMarketHolidays.includes(dateKey);

                const dayElement = createDayElement(dateKey, isHoliday); // Pass both holiday and weekend status

                const createStockNameField = () => {
                    const inputGroup = document.createElement("div");
                    inputGroup.className = "input-group";

                    const label = document.createElement("label");
                    label.textContent = "Underlying:";

                    const savedStockName = savedData[dateKey] ?.stockName || "";

                    // Create a text field to display the stock name
                    const textField = document.createElement("div");
                    textField.className = "data-field";
                    textField.textContent = savedStockName || "";
                    textField.onclick = () => {
                        // Convert to a dropdown on click
                        const selectField = document.createElement("select");
                        selectField.disabled = isHoliday; // Disable if it's a holiday
                        stockOptions.forEach(stock => {
                            const option = document.createElement("option");
                            option.value = stock;
                            option.textContent = stock;
                            selectField.appendChild(option);
                        });
                        selectField.value = savedStockName;
                        selectField.onblur = () => {
                            // Save the selected value and revert to text
                            savedData[dateKey] = savedData[dateKey] || {};
                            savedData[dateKey].stockName = selectField.value;
                            textField.textContent = selectField.value;
                            inputGroup.replaceChild(textField, selectField);
                        };
                        inputGroup.replaceChild(selectField, textField);
                        selectField.focus();
                    };

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(textField);

                    return inputGroup;
                };


                const createProfitField = () => {
                    const inputGroup = document.createElement("div");
                    inputGroup.className = "input-group";

                    const label = document.createElement("label");
                    label.textContent = "Profit (CAD):";

                    const dataField = document.createElement("div");
                    dataField.className = "data-field";
                    dataField.contentEditable = !isHoliday;
                    dataField.textContent = savedData[dateKey] ?.profit || "";

                    // Set background color based on profit or loss
                    if (!isHoliday) {
                        const profitValue = parseFloat(dataField.textContent) || 0;
                        dayElement.style.backgroundColor = profitValue > 0 ? "#306844" : (profitValue < 0 ? "#940000" : "");
                    }


                    if (!isHoliday) {
                        dataField.onclick = () => {
                            dataField.contentEditable = true;
                            dataField.classList.add("editable");
                        };
                        dataField.onblur = () => {
                            console.log("Here");
                            dataField.contentEditable = false;
                            dataField.classList.remove("editable");
                            savedData[dateKey] = savedData[dateKey] || {};
                            savedData[dateKey].profit = dataField.textContent;

                            const updatedProfitValue = parseFloat(dataField.textContent) || 0;
                            dataField.style.backgroundColor = updatedProfitValue > 0 ? "#306844" : (updatedProfitValue < 0 ? "#940000" : "");

                            // Recalculate and update the total profit and statistics for the month
                            generateCalendar();
                        };
                    }

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(dataField);

                    return inputGroup;
                };

                const createTradesField = () => {
                    const inputGroup = document.createElement("div");
                    inputGroup.className = "input-group";

                    const label = document.createElement("label");
                    label.textContent = "Number of Trades:";

                    const dataField = document.createElement("div");
                    dataField.className = "data-field";
                    dataField.contentEditable = !isHoliday;
                    dataField.textContent = savedData[dateKey] ?.trades || "";

                    if (!isHoliday) {
                        dataField.onclick = () => {
                            dataField.contentEditable = true;
                            dataField.classList.add("editable");
                        };
                        dataField.onblur = () => {
                            dataField.contentEditable = false;
                            dataField.classList.remove("editable");
                            savedData[dateKey] = savedData[dateKey] || {};
                            savedData[dateKey].trades = dataField.textContent;

                            // Recalculate statistics
                            generateCalendar();
                        };
                    }

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(dataField);

                    return inputGroup;
                };

                const stockNameField = createStockNameField();
                const profitField = createProfitField();
                const tradesField = createTradesField();

                dayElement.appendChild(stockNameField);
                dayElement.appendChild(profitField);
                dayElement.appendChild(tradesField);

                calendar.appendChild(dayElement);
            }
        });
    };

    // Load initial data from a saved CSV file or localStorage
    const loadInitialData = () => {
        const localCSV = localStorage.getItem("calendarCSV");
        if (localCSV) {
            const blob = new Blob([localCSV], { type: 'text/csv' });
            loadFromCSV(new File([blob], "loaded.csv"));
        } else {
            generateCalendar(); // No saved data
        }
    };

    // Save data to localStorage for persistence
    const saveToLocalStorage = () => {
        const rows = [
            ["Date", "Underlying", "Profit (CAD)", "Number of Trades"]
        ];
        for (const [date, data] of Object.entries(savedData)) {
            rows.push([date, data.stockName || "", data.profit || "", data.trades || ""]);
        }
        const csvContent = rows.map(e => e.join(",")).join("\n");
        localStorage.setItem("calendarCSV", csvContent);
    };

    // Add event listener to save data to localStorage before unloading the page
    window.addEventListener("beforeunload", saveToLocalStorage);

    // Load data and generate the calendar on page load
    loadInitialData();
    </script>
</body>

</html>